Update format parsing to support f-strings and the str.format function.

Closes #6163, #6085
